name: build-docker-images

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Build Docker Images
      run: |
        for file in $(git diff-tree --no-commit-id --name-only -r HEAD); do
          if [[ "$file" == *"Dockerfile"* ]]; then
            directory=$(dirname $file)
            if [[ "$directory" == "casa-"* ]]; then
              upperdir=$(dirname $directory)
              image_name=$(basename $upperdir)-$(basename $directory)
            else 
              image_name=$(basename $directory)
            fi
            image_name=$(echo "$image_name" | tr '[:upper:]' '[:lower:]')
            docker build -t "$image_name" $directory
          fi
        done